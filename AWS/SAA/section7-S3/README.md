## 데이터 저장 방식
### 오브젝트 스토리지  

- 오브젝트라고 불리는 개별 유닛에 데이터를 저장하는 스토리지 포맷
- 각 유닛에는 고유의 식별자 혹은 키가 있어서 분산된 시스템 내 어디에 저장 되어 있든지 상관 없이 데이터를 찾을 수 있음
- 각각의 오브젝트에는 키, 데이터 및 옵션 메타데이터가 포함
- Amazon S3

### 블록 스토리지

- 데이터를 고정된 사이즈의 블록으로 나누어 각각 고유한 식별자와 함께 저장하는 방식
- 각 데이터 블록은 고유 식별자를 부여 받아 스토리지 시스템이 데이터 조각을 원하는 곳에 배치가능(예, 일부 데이터는 리눅스 환경에 저장하고 일부는 Windows 장치에 저장)
- Amazon EBS

### 파일 스토리지

- 데이터는 계층적 파일 디렉터리 내의 폴더에서 파일로 저장
- 해당 데이터에 액세스 해야 하는 경우, 컴퓨터는 그 데이터를 찾기 위해 경로를 알아야 함
- 파일에 저장된 데이터는 제한된 양의 메타데이터(해당 파일 자체가 보관된 정확한 위치를 알려주는 데이터)를 사용해 구성 및 검색
- Amazon EFS, Amazon FSx

## S3 개요, 버킷 및 객체

- 거의 무제한 저장용량을 제공하는 객체(Object) 스토리지 서비스
- 대부분의 경우 최소 3개의 가용영역에 데이터를 자동 분산 저장하기에 성능, 확장성, 가용성, 내구성이 높음
- 대표적 사용사례 : 백업 및 복원 재해 복구(DR), 아카이브, 클라우드 스토리지 정적 웹사이트 호스팅

### 버킷
- 오브젝트 저장 공간
- 버킷은 리전단위로 생성
- 버킷 이름은 유니크 해야함(다른 AWS 사용자와 중복 불가, 동일한 이름으로 버킷을 2개 생성 불가)

## 객체
- 오브젝트(파일)
- 개별 오브젝트 최대 사이즈는 5TB

## S3 버전 관리
-  객체를 여러 버전으로 보존 하는 기능
- 동일한 파일이름을 업로드 하면 여러 버전으로 저장됨(예, 버전1, 버전2...)
- 실수로 객체를 덮어쓰거나 삭제한 경우 이전 버전으로 복구 가능
- MFA Delete를 설정 하여 다른 보안 계층 추가 기능
  - 버킷의 버전 관리 상태 변경, 객체 버전 영구 삭제 시 MFA 추가 인증을 요구
  - 버전관리 + MFA Delete를 조합하여 더 강력한 삭제 방지 구현
- 버전관리 기능을 사용하려면 해당 기능을 활성화 해야함

## S3 데이터 암호화
- 데이터를 전송 중에 그리고 스토리지에 저장된 동안 보호하기 위해 암호화 사용 
### 서버 측 암호화(SSE- Server Side Encryption)
- 데이터가 서버에 저장되기 전에 객체를 암호화
- 암호화 유형
  - SSE-S3
    - S3에서 관리하는 암호화
  - SSE-KMS, DSSE-KMS
    - AWS KMS(Key Management Service)에서 관리하는 암호화
    - 키관리 서비스를 이용하므로 키를 자동 교체하거나 감사 기능을 지원 가능
  - SSE-C
    - 고객(사용자)가 관리하는 암호화
    - 데이터 전송 시 반드시 HTTPS를 사용해야 함
### 클라이언트 측 암호화
- 데이터를 전송하기 전에 클라이언트 사이드에서 암호화

### 전송 중 암호화
- 전송 보안 프로토콜 SSL/TLS를 이용해 데이터를 암호화
- HTTPS 보안 프로토콜을 사용하여 전송

## S3 액세스 관리
### 버킷 정책
- S3 버킷 액세스 제어 정책
- JSON 형식
- 조건에 따라 버킷에 액세스를 부여하고 제한하느 기능으로 사용
- 예, 특정 AWS 리소스에서만 S3 버킷에 액세스 허용
- 예, 다른 AWS 계정에 버킷 액세스 권한을 부여 가능(교차 계정 액세스 권한)

### 퍼블릭 액세스 차단(버킷 설정)
- 버킷과 객체에 대한 퍼블릭 액세스를 차단하거나 허용
- 데이터 보호를 위해 기본적으로 퍼블릭 액세스를 차단

### ACL(액세스 제어 목록)
- AWS 계정에 버킷이나 객체에 대한 읽기/쓰기 권한을 부여하는 기능
- 버킷 레벨에서 ACL을 적용하거나 객체 레벨에서 ACL을 적용 가능
- 각 객체에 대한 액세스를 개별적으로 제어하는 경우를 제외하고는 ACL 비활성화 권장

## S3 정적 웹사이트 호스팅
- S3에서 정적 웹사이트 호스팅 가능
- 정적 웹사이트 : 언제 접속해도 항상 같은 내용을 보여주는 변하지 않는 사이트(회사 소개 홈페이지)
- 동적 웹사이트 : 접속할 때마다 다른 내뇽이 변하는 사이트(커뮤니티 홈페이지, SNS 홈페이지, 쇼핑몰)
- S3에서 웹사이트 호스팅을 하면 EC2등의 별도의 웹서버 운영을 하지 않아도 되기에 운영 오버헤드를 줄일 수 있음
- 웹사이트 주소는 버킷이름.s3-website-리전.amazonaws.com 형식
- 사이트 접속시 403에러(액세스 거부)가 나오면 버킷의 퍼블릭 액세스 허용이 안되어 있다는 것임

### S3 정적 웹사이트 호스팅 - 버킷 정책
```json
{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Sid": "PublicReadGetObject",
      "Effect": "Allow",
      "Principal": "*",
      "Action": [
        "s3:GetObject"
      ],
      "Resource": [
        "arn:aws:s3:::Bucket-Name/*"
      ]
    }
  ]
}
```

## S3 Cross-origin resource sharing(CORS)
- Origin : 도메인 주소 또는 S3 버킷의 주소(예: http://website.s3-website.us-east-1.amazonaws.com)
- 같은 Origin : http://www.amazon111.com/video = http://www.amazon111.com/audio
- 다른 Origin: http://www.amazon111.com != http://www.amazon222.com
- CORS는 한 도메인(오리진)에서 로드되어 다른 도메인(오리진)에 있는 리소스에 버킷에 대한 액세스를 공유/허용 하는것
- 권한이 없는 사용자가 도메인에 액세스 하는 것을 방지할 수 있음

## S3 복제(Replication)
### S3 Replication(복제 규칙)
- S3 버킷간에 객체를 자동으로 복제하는 기능
- 2가지 복제 유형
  - 교차 리전 복제(CRR, Cross-Region Replication)
    - 서로 다른 AWS 리전의 S3 버킷으로 객체를 복사
    - 사용사례
      - 지리적으로 가까운 액세스가 필요한 경우
      - 재해복구(DR)
  - 동일 리전 복제(SRR, Same Region Replication)
    - 같은 AWS 리전의 S3버킷으로 객체를 복사
    - 사용사례
      - 동일한 데이터를 사용하는 프로덕션과 테스트 계정 간의 복제
      - 법적 준수사항으로 같은 리전안에 데이터 복사본을 만들어 놓아야 하는 경우
- 버킷 복제를 위해서는 원본과 대상 버킷 모두 버전관리가 활성화 되어 있어야 함
- 다른 AWS 계정의 버킷으로도 복제 가능

## S3 스토리지 클래스(Storage Class)
- S3 Standard(범용)
  - 짧은 지연 시간과 많은 처리량을 제공
  - 일반적인 용도의 다양한 사용 사례에 적합
- S3 Intelligent-Tiering (액세스 패턴을 알 수 없거나 예측할 수 없는 데이터용)
  - 액세스 패턴을 모니터링하고, 액세스하지 않은 객체를 저렴한 액세스 계층으로 자동으로 이동
  - 액세스 패턴을 알 수 없거나 액세스 패턴이 변화하는 데이터에 대한 스토리지 비용을 최적화하려는 경우에 사용
  - 액세스 계층 이동
    - S3 Intelligent-Tiering에 업로드하거나 이전한 객체는 Frequent Access 계층에 자동으로 저장
    - 30일 연속 액세스되지 않은 객체를 Infrequent Access 계층으로 이동
    - 90일 연속으로 액세스되지 않은 객체를 Archive Access 계층으로 이동
    - 180일 연속으로 액세스되지 않으면 객체를 Deep Archive Access 계층으로 이동
- S3 Standard-IA(빈번하지 않은 액세스용)
  - 자주 액세스하지 않지만 필요할 때 빠르게 액세스해야 하는 데이터에 적합
  - 최소 과금 기간 30일 (30일이 끝나기 전에 객체를 삭제하면 30일 요금이 부과)
  - 1개월 또는 2개월에 한 번 액세스하고 1개월 이상 보존하는 데이터에 적합
- S3 One Zone-IA(빈번하지 않은 액세스용)
  - 자주 액세스하지 않지만 필요할 때 빠르게 액세스해야 하는 데이터에 적합
  - 최소 3개의 가용 영역(AZ)에 데이터를 저장하는 다른 S3 스토리지 클래스와는 달리 단일 AZ에 데이터를 저장하며 비용이 S3 Standard-IA보다 저렴
  -  가용성 및 복원력이 필요 없는 고객에게 적합
  - 최소 과금 기간 30일 (30일이 끝나기 전에 객체를 삭제하면 30일 요금이 부과)
- S3 Glacier Instant Retrieval (아카이브용)
  - 저렴한 비용으로 장기 보관하는 백업 용도
  - 분기에 한 번 액세스하는 오래된 아카이브 데이터 용도
  - 검색시간 : 밀리초 내에 즉시 검색
  - 최소 과금 기간 90일
-  S3 Glacier Flexible Retrieval/이전 명칭 S3 Glacier (아카이브용)
  - 저렴한 비용으로 장기 보관하는 백업 용도
  - 일 년에 한 번 액세스하는 오래된 아카이브 데이터 용도
  - 검색시간 : 몇 분 내지 몇 시간의 검색 시간 소요 (검색옵션 : 신속 1 – 5 분, 표준 3 – 5시간, 대량 5 -12 시간)
  - 최소 과금 기간 90일
- S3 Glacier Deep Archive(아카이브용)
  - 가장 저렴한 비용의 스토리지 클래스
  - 일 년에 한 번 미만으로 액세스하는 오래된 아카이브 데이터 용도
  - 7-10년 이상 데이터를 장기 보관하는 용도
  - 검색시간: 몇 시간 (검색옵션: 표준 12시간이내, 대량 48시간 이내)
  - 최소 과금 기간 180일

## S3 수명 주기(Lifecycle Policy)
- 객체가 저장되어 삭제될 때까지의 수명주기를 비용 효율적으로 저장 되도록 관리하는 기능
- 버전 관리가 활성화 되어 있을 경우 객체의 버전별로 수명 주기 정책을 적용할 수 있음
- Amazon S3 Storage Class Analysis (스토리지 클래스 분석)
  - 데이터 액세스 패턴을 관찰해 자주 액세스하지 않는 STANDARD 스토리지를 STANDARD_IA 스토리지 클래스로 옮길 시점을 알려줌

## S3 Glacier Vault Lock and Object Lock
- S3 Glacier Valut는 아카이브 데이터를 저장하는 스토리지 컨테이너 서비스
- S3 처럼 콘솔을 통해 데이터 업로드를 할 수 없고 CLI, 코드 등의 명령어를 통해 데이터를 업로드
- S3 Glacier Vault Lock을 사용하여 파일 저장 후 삭제, 편집을 못하도록 정책을 잠글 수 있음
- Write Once Read Many(WORM) 모델을 적용
- Vault Lock을 사용하기 위해서는 Vault Lock 정책을 생성
- Vault 정책이 생성된 이후에 더 이상 변경이나 삭제 불가
- 데이터 보관 규정 준수 정책이 있는 경우에 Vault Lock 사용

## S3 Object Lock(S3 객체 잠금)
- 일정시간 또는 무기한으로 객체가 삭제되거나 덮어쓰이지 않도록하는 기능으로 읽기만 가능
- 보관 기간을 설정해여 정해진 시간동안 객체를 보호하도록 설정 가능
- Write Once Read Many(WORM) 모델을 적용
- 객체 잠금을 사용하려면 버전관리가 활성화 되어 있어야 함
- 두 가지 보관 모드를 사용 가능
  - 거버넌스 모드:필요에 따라 일부 사용자에게 보관 설정을 변경하거나 객체를 삭제할 수 있는 권한을 부여할 수 있음
  - 규정준수 모드: AWS 계정의 루트 사용자를 포함한 어떤 사용자도 덮어쓰거나 삭제할 수 없음
- Legal Hold(법적 보존)
  - 객체 버전을 덮어쓰거나 삭제할 수 없도록 하는 기능
  - 객체를 수정해야 하는 사용자의 IAM 정책에 s3 PutObjectLegalHold 권한을 추가하면 해당 사용자는 객체를 수정, 삭제 가능

## S3 모니터링
- S3 버킷에 대한 액세스 요청을 로그 파일로 만들어 S3 버킷이 저장하는 기능
- 액세스 로그 레코드는 한 액세스 요청에 대한 세부정보(요청자, 버킷 이름, 요청 시간, 요청 작업, 응답 상태, 오류 코드)를 제공
- 감사 목적으로 활용 가능
- 로그 분석을 위해 Amazon Athena같은 분석 도구를 사용가능
- 로그 파일 저장소를 같은 버킷에 하지 말 것!(무한 루프로 인해 로그파일 지속적 증가)

## S3 Transfer Acceleration (S3 전송 성능 향상)
- 클라이언트와 S3 버킷 간의 장거리 파일 전송을 파일을 빠르고 쉽고 안전하게 전송하는 기능
- 전 세계에 분산된 엣지 로케이션을 활용하여 최적화된 네트워크 경로를 통해 Amazon S3로 라우팅
- 사용 사례
  - 전 세계 각지에서 중앙의 버킷으로 업로드하는 고객이 있는 경우
  - 전 세계에 정기적으로 수 기가바이트에서 수 테라바이트의 데이터를 전송할 경우
  - Amzaon S3에 업로드할 때 인터넷을 통해 사용 가능한 대역폭을 충분히 활용할 수 없는 경우

## S3 Multi-Part Upload
- 단일 파일을 분할하여 병령오 S3에 업로드 하는 방식
- 파트를 병렬로 업로드 하기에 빠른 처리 속도로 업로드 가능
- S3 단일 객체의 최대 업로드 용량은 5GB
- 다인 객체의 크기가 100MB를 넘는 경우 멀티파트 업로드 기능을 사용하는 것을 추천
- 멀티파트 업로드가 중간에 실패해도 저장 비용이 청구되기에 재전송 또는 수명 주기 정책을 통해 완료되지 않은 업로드를 삭제하여 비용 절감

## S3 데이터 처리
### S3 이벤트 알림(S3 Event Notifications)
- S3 버킷에서 특정 이벤트가 발생할 때 알림을 보내는 기능
- S3 이벤트 알림과 수신 대상 서비스를 결합하여 다양한 애플리케이션을 구현 가능
- 예, S3 버킷에 그림 파일 객체 생성시 이벤트 알림을 통해 객체에 메타데이터 추가, 파일 포맷 변경등 수행

### S3 Object Lambda
- 애픜리케이션으로 데이터가 반환될 때 데이터를 수정 및 처리하는 기능
- S3 Object Lambda 사용하여 자체 코드를 추가하여 S3에서 검색한 데이터를 애플리케이션으로 반환하기 전에 처리할 수 있음
- 예, 사용자 지정 코드를 사용하여 이미지 크기 조정, 워터마크 삽입, 파일 형식 변환 ,객체 이름 변환 등 수행
- 애플리케이션을 변경할 필요 없이 S3 Object Lambda 데이터 변환을 사례에 맞게 조정하여 사용자 지정 Lambda 함수를 작성 및 실행 가능

사용사례
1. 애플리케이션에서 S3 Object Lambda 액세스 포인트를 통해 표준 S3 GET 요청을 전송
2. 지정된 Lambda 함수가 호출되어 S3 액세스 포인트를 통해 S3 버킷에서 검색된 모든 데이터를 처리
3. S3 객체 Lambda 액세스 포인트가 변환된 결과를 애플리케이션에 다시 반환