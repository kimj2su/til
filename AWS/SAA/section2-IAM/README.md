# AWS Identity and Access Management(IAM)

## IAM 개요
- AWS 계정 및 권한 관리 서비스
- 사용자, 그룹, 역할, 정책으로 구성
- 리전에 속하는 서비스가 아닌 글로벌 서비스
- 계정 보안 강화를 위한 권장 사항
  - 루트 계정 (AWS회원 가입시 만들어지는 계정)은 최초 사용자 계정 생성 이후 가능하면 사용하지 말 것
  - 사용자 계정(IAM 계정)으로 서비스를 사용하고 사용자는 필요한 최소한의 권한만 부여(최소권한의 원칙)
  - 루트계정과 개별 사용자 계정에 강력한 암호 정책과 멀티팩터 인증(MFA) 적용
  - 사용자의 암호에 대한 복잡성 요구 사항과 의무 교체 주기를 정의

### 사용자 
- 개인 또는 애플리케이션을 위한 특정 권한을 가진 ID
### 그룹
- 개발팀, 운영팀 등의 사용자의 집합
### 역할
- 특정 개인에 속하지 않은 특정 권한을 가진 ID
### 정책
- 할 수 있는 것과 할 수 없는 것에 대한 권한 정의
- 사용자, 그룹, 역할에 연결 하여 사용
- JSON 문서 형식으로 구성

## IAM 사용자
- 단일 개인 또는 애플리케이션에 대한 특정 권한을 가지고 있는 AWS 계정 내 자격 증명
- 한 사람과만 연관(한 명의 실제 사용자)
- 암호 또는 액세스 키와 같은 장기 자격 증명을 통해 액세스
- IAM -> 계정 설정 -> 암호 정책 -> IAM 사용자에 대한 암호 정책을 변경할 수 있다.
- 계정 -> 보안 자격 증명 -> MFA 설정 가능
- IAM -> 사용자 -> 사용자 생성 -> 사용자 이름 입력 -> AWS Management Console 체크
-> IAM 사용자를 생성하고 싶음 체크 -> 사용자 지정 암호
- 그룹 생성 -> AdministratorAccess 할당 -> 생성
- 사용자 -> 이름 -> 액세스 키 만들기 -> 로컬 코드 등등

## IAM 정책
- AWS 리소스에 대한 액세스 권한을 정의 한 것
- 사용자, 그룹, 역할에 정책을 연결하여 사용
- JSON 문서 형식으로 이루어짐
- 정책이 명시되지 않는 경우 기본적으로 모든 요청이 거부(Deny) 됨
```json
{
  "Statement" : [{
    "Effect" : "effect",
    "Action" : "action",
    "Resource" : "arn",
    "Condition" : {
      "condition" : {
        "key" : "value"
      }
    }
  }]
}
```
- Effect : Allow 또는 Deny를 사용하여 명시도니 정책에 대해 액세스 허용 또는 거부
- Action : 정책이 허용하거나 거부하는 작업 목록
- Resource : 작업이 적용되는 리소스
- Condition : 정책이 적용된느 세부 조건(옵션 사항)

## IAM - 자격 증명 기반 정책
### 관리형 정책
- AWS 계정에 속한 다수의 사용자, 그룹 및 역할에 연결할 수 있는 정책
  - AWS 관리형 정책 - AWS에서 생성 및 관리
  - 고객 관리형 정책 - 사용자가 생성 및 관리

### 인라인 정책
- 단일 사용자, 그룹 또는 역할에 직접 추가하는 정책

## IAM - 권한 경계(Permission Boundary)
- IAM 사용자 또는 역할에 최대 권한을 제한 하는기능
- 예, IAM 사용자에게 Amazon S3, Amazon CloudWatch 및 Amazon EC2만 관리할 수 있게 하려면 아래와 같은 정책을 적용
- AWS 전체 권한을 가지고 있어도 권한 경계에 대한 권한 범위로 축소되어 적용됨
```json
{
  "Version" : "2012-10-17",,
  "Statement" : [{
    "Effect" : "Allow",
    "Action" : [
      "s3",
      "cloudwatch",
      "ec2"
    ],
    "Resource" : "arn"
  }]
}
```

## IAM 역할
- 특정 권한을 가지고 있는 AWS 계정 내 자격 증명
- AWS 자격 증명이라는 점에서 IAM 역할은 IAM 사용자와 유사
- 역할은 한 사람과만 연관되지 않고 해당 역할이 필요한 IAM 사용자, 애플리케이션 , AWS 서비스 등 누구든지 맡을 수 있음
- 역할에는 암호 또는 액세스 키와 같은 장기 증명이 없고 해당 역할 세션을 위한 임시 보안 자격 증명이 제공
- AWS Security Token Service(AWS STS)를 사용해 AWS 리소스에 대한 액세스를 제어할 수 있는 임시 보안 자격 증명을 생성
- IAM 역할을 맡는 경우 발급되는 토큰은 일시적이며 만료되면 보안 인증 정보가 유출되고 재사용되는 것과 관련된 위험이 줄어듬
- 역할을 사용하여 AWS 리소스에 엑세스할 수 없는 사용자, 애플리케이션 또는 서비스에 엑세스 권한을 위임
### 사용 예
- AWs 계정의 사용자에게 권한이 없는 리소스에 대한 액세스 권한을 부여
- 한 AWS 계정의 사용자에게 다른 계정의 리소스에 대한 액세스 권한을 부여
- 모바일 앱에서 AWS 리소스를 사용할 수 있도록 하되 앱에 AWS 키를 내장(교체하기 어렵고 사용자가 추출할 가능성이 있음)하길 원치 않는 경우
- 기업 디렉터리에서처럼 AWS 외부에 정의된 자격 증명을 이미 보유하고 있는 사용자에게 AWS 액세스 권한을 부여

## IAM - 역할 사용 주체
- AWS 서비스(예: Amazon EC2)
- 역할과 동일하거나 다른 AWS 계정의 IAM 사용자
- Amazon, Facebook 또는 Google과 같은 제 3자 웹 자격증명 공급자의 사용자
- SAML 2.0 등과 호환되는 외부 자격 증명 공급자 (ldp) 서비스에 의해 인증된 외부 사용자

### IAM - 역할이 사용되는 시나리오 (AWS 서비스에 대한 액세스 권한 부여)
- AWS 리소스에서 사용하는 자격증명
- 특정 AWS 서비스가 다른 AWS 서비스에 액세스 하여 작업을 수행할 때 필요한 권한
- EC2에서 실행되는 애플리케이션이 S3와 RDS 액세스 권한이 필요할 때 역할 사용

### IAM - 역할이 사용되는 시나리오 (IAM 사용자에게 역할 부여)
- 동일한 AWS 계정의 IAM 사용자에게 역할 부여
- 다른 AWS 계정의 IAM 사용자에게 역할 부여(교차 계정 액세스)

부여된 역할 사용 방법
- IAM 콘솔을 사용하는 계정의 IAM 사용자가 역할을 전환하여 콘솔에서 해당 역할의 권한을 임시로 사용
- 사용자는 자신의 원래 권한을 포기하고 역할에 할당된 권한을 수임
- 사용자가 역할을 끝내면 원래 권한이 복원

##  IAM - 역할(신뢰 정책)
- IAM 역할에 대한 리소스 기반 정책
- 역할을 맡을 수 있는 보안 주체와 조건을 정의

## IAM - 사용자(User) vs 역할(Role)
- 사용자는 사람을 위한 것이고 역할은 AWS Resource를 위한 것이다.

## IAM 보안 도구 (IAM Security Tools)
- IAM 자격증명 보고서 (Credentials Report)
  -계정의 모든 사용자와 암호, 액세스 키, MFA 디바이스 등의 자격 증명 상태에 대한 보고서를 다운로드
- IAM 액세스 관리자 (Access Advisor)
  - 사용자 또는 역할이 허용된 서비스에 마지막으로 액세스 하려고 시도한 시간을 표시
  - 이 정보를 사용해 필요이상으로 부여된 권한을 재정의 하는데 참고 가능

### 자격 증명 보고서
- iAM - > 자격 증명 보고서 -> csv로 다운도드 됨

### 액세스 관리자
- iAM - > 계정 클릭 - > 액세스 관리자  -> 해당 서비스에 마지막으로 액세스한 시간이 표시 됨 
- IAM -> 역할 -> 목록 중 아무거나 클릭 ->  액세스 관리자로 확인할 수 있다.