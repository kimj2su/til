# 전송 계층의 두가지 역할
응용, 표현, 세션, 전송, 네트워크, 데이터 링크, 물리 중 전송 계층의 역할을 알아본다.  
물리(1계층), 데이터(2계층), 네트워크(3계층)는 데이터를 전송하는 역할을 한다.  
하지만 데이터가 손상되거나 유실되더라도 이들 계층에서는 아무것도 해주지 않는다.  
전송 계층은 목적지에 신뢰할 수 있는 데이터를 전달하기 위해 필요하다.  
1. 전송 계층에는 오류를 점검하는 기능이 있다.  
2. 전송된 데이터의 목적지가 어떤 애플리케이션인지 식별하는 기능도 있다.

# 연결형 통신과 비연결형 통신
전송 계층의 특징을 간단히 설명하면 신뢰서/정확성 과 효율성으로 구분할 수 있다.  
신뢰성/정확성은 데이터를 목적지에 문제없이 전달하는 것이고, 효율성은 데이터를 빠르고 효율적으로 전달하는 것이다.  
신뢰할 수 있고 정확한 데이터를 전달하는 방식을 연결형 통신, 효율적으로 데이터를 전달하는 방식을 비연결형 통신이라고 한다.  
전송 계층의 연결형 통신 프로토콜에는 TCP가 사용되고 비연결형 통신 프로토콜에는 UDP가 사용된다.  

# 캡슐화와 역캡슐화
응용 계층부터 물리 계층까지 계층별로 데이터를 전달할 때 헤더를 붙이는것을 캡슐화라고한다.  
반대로 물리 계층부터 응용 계층까지 계층별로 데이터를 전달할 때 헤더를 제거하는것이 역캡슐화이다.  
[응용] - 데이터 -> [전송] - (헤더) + 데이터 -> [네트워크] - (헤더) + 헤더 + 데이터 -> [데이터 링크] - (헤더) + 헤더 + 헤더 + 데이터 + 트레일러 -> [물리]
= 헤더 + 헤더 + 헤더 + 데이터 + 트레일러  

-> 전기 신호로 전송 된다.

[물리] - 헤더 + 헤더 + 헤더 + 데이터 + 트레일러 -> [데이터 링크] - 헤더(제거) + 헤더 + 헤더 + 데이터 + 트레일러(제거) -> [네트워크] - 헤더(제거) + 헤더 + 데이터 + 트레일러(제거) -> [전송] - 헤더(제거) + 데이터 -> [응용] - 데이터

# TCP
TCP는 연결형 통신 프로토콜이다.  
TCP로 전송할때 붙이는 헤더를 TCP 헤더라고 하고 이 TCP 헤더가 붙은 데이터를 세그먼트(segment)라고 한다.

## TCP 헤더
목적지 까지 제대로 전송하기 위해 필요한 정보를 가지고 있다.

1. 출발 포트번호(16비트)
2. 목적지 포트 번호(16비트)
3. 시퀀스 번호(32비트)
4. 확인 응답 번호(32비트)
5. 헤더 길이(4비트)
6. 예약(6비트)
7. 코드 비트(6비트)
8. 윈도우 크기(16비트)
9. 체크섬(16비트)
10. 긴급 포인터(16비트)
11. 옵션(가변)

여기서 7번 코드 비트에는 107번째 비트부터 112번째 비트까지의 6비트로 연결의 제어 정보가 기록되어 있다.  

|URG|ACK|PSH|RST|SYN|FIN|
|:---:|:---:|:---:|:---:|:---:|:---:|
|0|0|0|0|0|0|

초깃값은 0이고 비트가 활성화되면 1이 된다. 연결을 확립하기 위해 SYN과 ACK 비트를 사용한다.  
SYN은 연결 요청, ACK는 연결 응답을 의미한다.

# 3-way handshake
TCP는 연결형 통신이기 때문에 연결을 확립해야한다.
1. 클라이언트가 서버에 연결 요청을 보낸다. (SYN = 1, ACK = 0)
2. 서버가 클라이언트에 연결 요청을 수락한다. (SYN = 1, ACK = 1)
3. 클라이언트가 서버에 연결 요청을 수락한다. (SYN = 0, ACK = 1)

이 처럼 데이터를 보내기 전에 연결을 확립하기 위해 패킷 요청을 세번 교환하는것을 3-way handshake라고 한다.  
연결을 끊을 때에는 FIN과 ACK 비트를 사용한다.
1. 클라이언트가 서버에 연결 종료 요청을 보낸다. (FIN = 1, ACK = 0)
2. 서버가 클라이언트에 연결 종료 요청을 수락한다. (FIN = 0, ACK = 1)
3. 서버가 클라이언트에 연결 종료 요청을 보낸다. (FIN = 1, ACK = 0)
4. 클라이언트가 서버에 연결 종료 요청을 수락한다. (FIN = 0, ACK = 1)

# 일련번호와 확인 응답 번호의 구조
TCP 헤더에는 시퀀스 번호와 확인 응답 번호가 있다.  
3-way 핸드세이크가 끝나고 실제 데이터를 보내거나 상대방이 받을때는 일련번호와 확인 응답 번호를 사용한다.  
일련번호는 데이터의 순서를 나타내고 확인 응답 번호는 상대방이 받은 데이터의 순서를 나타낸다.  
데이터가 손솽되거나 유실된 경우에 데이터를 재전송하게 되어 있는데 이걸 재전송 제어라고한다.

# 윈도우 크기
위의 일련번호와 확인 응답 번호는 세그먼트 하나를 보낼때마다 확인하게 되면 효율이 낮아지게 된다.  
매번 응답을 기다리는 대신 세그먼트를 연속해서 보내고 난 뒤에 확인 응답을 받으면 효율이 높아진다.  
세그먼트를 일시적으로 보고나하는 장소를 버퍼라고한다.  
버퍼가 넘치는 것을 오버플로라고한다.  
윈도우 크기는 버퍼의 크기를 나타낸다.  
3-way 핸드세이크가 끝나고 데이터를 보낼 때 윈도우 크기를 설정한다.  
윈도우 크기는 데이터를 보내고 확인 응답을 받을 때 데이터를 보내는 쪽에서 받는 쪽으로 확인 응답을 받지 않고 보낼 수 있는 데이터의 양을 나타낸다.

# 포트 번호
전송 계층에서는 전송된 데이터의 목적지가 어떤 애플리케이션인지 구분하는 역할이 있다.  
TCP 헤더의 출발지 포트와 목적지 포트가 그 역할을 한다.  
출발지 포트와 목적지 포트는 16비트로 구성되어 있어서 0 ~ 65535까지의 포트 번호를 사용할 수 있다.  
0 ~ 1023까지는 잘 알려진 포트 번호라고 하고, 1024 ~ 49151까지는 랜덤 포트라고 해서 클라이언트 측의 송신 포트로 사용된다.  

|애플리케이션|포트 번호|
|:---:|:---:|
|FTP|20, 21|
|SSH|22|
|Telnet|23|
|SMTP|25|
|DNS|53|
|HTTP|80|
|POP3|110|
|HTTPS|443|

# UDP
UDP는 비연결형 통신 프로토콜이다.  
UDP는 TCP와 달리 효율성을 중요하게 여기는 프로토콜이나 TCP와 같은 신뢰성을 정확이 요구하게 되면 효울이 떨어진다.  
UDP의 장점은 데이터를 효율적으로 빠르게 보내는 것이라서 스트리밍 방식으로 전송하는 동영상 서비스와 같은 곳에 사용한다. 

# UDP 헤더
UDP 헤더가 붙은 데이터를 데이터그램(datagram)이라고 한다.  
1. 출발지 포트 번호(16비트)
2. 목적지 포트 번호(16비트)
3. 길이(16비트)
4. 체크섬(16비트)

# 브로드 캐스트
UDP를 사용하면 랜에 있는 컴퓨터나 네트워크 장비에 데이터를 일괄로 보낼 수 있는 방법이다.


# 정리
- 전송 계층은 데이터를 제대로 전달하는 역할을 하며, 오류를 점검하는 기능도 한다.
- 전송 계층은 전송된 데이터의 목적지가 어떤 애플리케이션인지 확인한다.
- 전송 계층에서는 TCP 헤더가 붙는다.
- TCP 헤더가 붙은 데이터를 세그먼트라고 한다.
- 연결을 확립하기 위해 TCP 헤더에 있는 코드비트를 사용하고 이를 3-way handshake라고 한다.
- 3-way 핸드셰이크 이후 데이터를 전송할 때는 TCP 헤더의 일련번호와 확인 응답번호가 사용된다.
- 데이터를 재전송하는것을 재전송 제어라고한다.
- 수신한 세크먼트(데이터)를 일시적으로 저장하는곳을 버퍼라고한다.
- 데이터 크기가 버퍼크기를 넘어서는 것을 오버플로라고한다.
- 버퍼 용량의 크기를 윈도우 크기라고 한다.
- 포트 번호는 어떤 애플리케이션인지 구분하는 역할을 한다.
- 포트 번호는 0 ~ 65535까지 사용할 수 있다. 0 ~ 1023까지는 잘 알려진 포트 번호라고 하고 1025 이후는 랜덤 포트라고 한다.
- UDP는 비연결형 통신 프로토콜이며 데이터를 효율적이고 빠르게 보낼 때 사용한다.
- UDP 헤더가 붙은 데이터를 데이터그램이라고 한다.