# 1.4 패킷 교환 네트워크에서의 지연, 손실과 처리율

## 1.4.1 패킷 교환 네트워크에서의 지연 개요
패킷은 한 호스트(출발지)에서 시작하고 일련의 라우터들을 통과하며 다른 호스트(목적지)에서 여행을 마친다.  
패킷은 경로상의 각 노드에서 다양한 지연을 겪게 된다.
중요한 지연으로는 **노드 처리 지연(node processing delay)**, **큐잉 지연(queueing delay)**, **전송 지연(transmission delay)**, **전파 지연(propagation delay)** 이 있다.  
이러한 지연들이 쌓여서 전체 지연을 일으킨다.  

<br/>

![스크린샷 2023-10-26 오후 9 15 56](https://github.com/jisu3316/til/assets/95600042/06f6a646-ae69-455f-a8dc-3757339e360b)

## 지연 유형
위의 그림에서 출발지와 목적지 사이 종단 간 경로의 일부로서 한 패킷이 업스트림 노드로부터 라우터 A를 통해 B로 보내진다.  
우리 목적은 라우터 A에서의 노드 지연 특성을 파악하는 것이다. 라우터 A가 라우터 B에 이르는 하나의 출력 링크를 갖는다.  
패킷이 라우터 A에 도착하면 패킷 헤더를 조사하고 출력 링크로 패킷을 보낸다.  
이 예에서는 패킷에 대한 출력 링크가 라우터 B에 이르는 링크다.  

### 처리 지연
패킷 헤더를 조사하고 그 패킷을 어디로 보낼지를 결정하는 시간은 처리 지연이라고 한다.  
고속 라우터에서의 처리 지연은 일반적으로 수 마이크로초다. 이 노드 처리 후에 라우터는 그 패킷을 라우터 В에 이르는 링크에 앞선 큐에 보낸다(4장에서 라우터가 어떻게 작동하는지 자세히 다룬다).  

### 큐잉 지연
패킷은 큐에서 링크로 전송되기를 기다리면서 큐잉 지연을 겪는다.  
이 지연은 큐에 있는 패킷의 수에 비례한다.


### 전송 지연
패킷이 선입선출 방식으로 전송된다고 가정하면 앞서 도착한 패킷이 먼저 전송되고 그 다음에 도착한 패킷이 전송된다.  
패킷의 길이를 L비트로, 라우터 A에서 라우터 B까지 링크의 전송률은 R bps라고 하자.  
전송 지연은 L/R초이다.  
이것은 패킷의 모든 비트를 링크로 밀어내는데 필요한 시간이다.

### 전파 지연
비트가 링크에 전해지면 라우터 B까지 전파 되어야 한다.  
링크의 처음부터 라우터 B까지의 전파에 필요한 시간이 전파 지연이다.

### 전송 지연과 전파 지연 비교
전송 지연과 전파 지연은 다르다.
전송 지연은 라우터가 패킷을 내보내는데 필요한 시간이고  
전파 지연은 비트가 한 라우터에서 다음 라우터로 전파되는데 걸리는 시간이다.  
패킷 -> A 2분   
A-> B 1시간  
A 에서 B 까지의 시간은 전송 지연과 전파 지연의 합이다.

## 1.4.2 패킷 교환 네트워크에서의 손실
노드 지연 중 가장 복잡하고 흥미로운 요소는 큐잉 지연, dquque이다.  
큐잉 지연은 패킷마다 다를 수 있다. 예를 들면 10개의 패킷이 동시에 비어 있는 큐에 도착한다면, 첫 패킷은 큐잉 지연이 없지만 마지막 패킷은
9개의 패킷이 큐를 통과하는 동안 큐잉 지연을 겪는다.

### 패킷 손실
현실에서 큐의 욜양은 스위치 설계와 비용에 크게 의존하며 일반적으로 유한한 크기를 갖는다.  
큐 용량이 유한하므로 트래픽 강도가 1에 접근함에 따라 패킷 지연이 실제로 무한대가 되진 않는다.  
대신에 패킷 이 도착해서 큐가 꽉 찬 것을 발견하게 된다. 이렇게 패킷을 저장할 수 없는 경우에 라우터는 그 패킷은 버린다.  
손실 패킷은 모든 데이터가 궁금적으로 출발지에서 목적지까지 전달되었음을 보장하기 위해 종단 간에 재전송돌 수 있다. 

## 1.4.3 종단 간 지연

### Traceroute
컴퓨터 네트워크에서의 지연을 느끼기 위해 Traceroute라는 진단 프로그램을 이용할 수 있다.
사용자가 목적지 호스트 이름을 제시하면 출발지 호스트에 있는 프로그램은 목적지를 향해 여러 개의 특별한 패킷을 보낸다.
이 패킷들은 목적지로 전진하면서 여러 개의 라우터를 통과한다.한 라우터가 이 특별한 패킷 중 하나를 받으면 출발지로 짧은 메시지를 보낸다.  
이 메시지에는 그 라우터의 이름과 주소가 포함되어 있다.


## 1.4.4 컴퓨터 네트워크에서의 처리율
지연과 패킷 손실 이외에 컴퓨터 네트워크에서의 또 다른 주요한 성능 수단은 종단 간 처리율이다.  
컴퓨터 네트워크에서의 주요한 성능 수단은 다음의 세 가지이다.

- 지연 정도
- 패킷 손실 확률
- `종단 간 처리율(throughput)`

<br/>

컴퓨터 네트워크를 통해 호스트 A에서 호스트 B로 커다란 파일을 전송하는 상황을 생각해보자.

해당 파일은 **F 비트**로 구성되며, 호스트 B가 파일의 모든 F 비트를 수신하는 데 **T초**가 걸린다고 한다면,

- 어느 한 순간에서의 `순간적인 처리율(instantaneous throughput)` = 호스트 B가 파일을 수신하는 비율(비트/초)
- `평균 처리율(average throughtput)` = F/T 비트/초

<br/>

인터넷 전화 같은 애플리케이션의 경우, **낮은 지연과 순간적인 처리율이 지속적으로** 어떤 임계값(threshold)을 넘는 것이 바람직하다.

파일 전송을 포함하는 다른 애플리케이션의 경우, 지연은 심각하지 않으나 **가능한 한 높은 처리율**을 가지는 것이 바람직하다.

<br/>

---