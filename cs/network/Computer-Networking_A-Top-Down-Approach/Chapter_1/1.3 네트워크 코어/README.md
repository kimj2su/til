# 1.3 네트워크 코어
네트워크 코어, 패킷 스위치와 링크 그물망을 살펴본다.

## 1.3.1 패킷 교환
네트워크 애플리케이션에서 종단 시스템들은 서로 메시지를 교환한다.  

### 패킷
- 출발지 종단 시스템에서 목적지 종단 시스템으로 보내기 위해 메시지를 분할한 작은 조각
- 통신 링크와 패킷 스위치(라우터와 링크 계층 스위치)를 거치게 된다.


### 패킷 스위치
![스크린샷 2023-10-24 오후 6.26.08.png](..%2F..%2F..%2F..%2F..%2F..%2F..%2F%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%2F%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202023-10-24%20%EC%98%A4%ED%9B%84%206.26.08.png)
- 패킷을 전달하는 역할을 한다.
- 저장후 전달 전송 방식 이용
- 라우터는 여러 개의 링크를 갖는데 그 이유는 라우터의 기능이 입력되는 패킷을 출력링크로 교환하는 것이기 때문이다.
- 위의 그림에서 라우터는 패킷1이 도착했지만 전달하지않고 3이 올때까지 기다렸다가 저장 후 전송을 한다.  

### 큐잉 지연과 패킷 손실
![스크린샷 2023-10-24 오후 6 29 37](https://github.com/jisu3316/til/assets/95600042/393d653a-52d8-4f0e-b6de-8a62193d91e8)
- 패킷 스위치는 여러개의 링크를 갖고 있고 각 링크에 대해 패킷 스위치는 출력 버퍼(출력 큐)를 갖고 있으며 송신하려는 패킷을 저장한다.
- 도착하는 패킷이 한 링크로 전송되어야 하는데 그 링크가 현재 다른 패킷을 전송하고 있으면 출력버퍼에서 대기해야 한다. 이것을 큐잉 지연이라고 한다.
- 가변적이고 네트워크의 혼잡 정도에 따름.
- 버퍼 공간의 크기는 유한하기 때문에 패킷이 도착했는데 버퍼가 꽉 차있으면 패킷을 버리게 된다. 이것을 패킷 손실이라고 한다.

### 포워딩 테이블과 라우팅 프로토콜
- 라우터는 목적지 주소를 라우터의 출력 링크로 매핑하는 포워딩 테이블을 갖고 있다.
- 패킷이 라우터에 도착하면 라우터는 올바른 출력 링크를 찾기 위해 주소를 조사하고 목적지 주소를 이용하여 포워딩 테이블을 검색한다.
- 인터넷은 자동으로 포워딩 테이블을 설정하는데 이용되는 여러 라우팅 프로토콜을 가지고 있다.
- 라우팅 프로토콜은 각 라우터로부터 각 목적지까지의 최단 경로를 결정 하고 라우터에 포워딩 테이블을 설정하는 데 이 최단 경로 결과를 이용한다.

## 1.3.2 회선 교환
회선 교환 네트워크에서 종단 시스템 간에 통신을 제공하기 위해 경로상에 필요한 자원(버퍼, 링크 전송률)은 통신 세션(session) 동안에 확보 또는 예약(reserve)된다.  

세션 메시지는 온디맨드(ondemand) 방식으로 자원을 요청하여 사용하고 그 결과, 통신 링크에 대한 접속을 위해 기 다릴(즉, 큐에서 대기) 수도 있다

![스크린샷 2023-10-24 오후 6 48 37](https://github.com/jisu3316/til/assets/95600042/78425814-0889-4dd1-85d4-690c29047231)

### 회선
대표적으로 전화망이 있다.
송신자와 수신자간의 연결을 설정해야 하고 이것은 송신자와 수신자간의 경로에 있는 스위치들이 해당 연결 상태를 유지해야 하는연결이다.  
전기통신 용어로 이 연결을 회선이라고 한다.
그 연결이 이루어지는 동안 네트워크 링크(각 링크의 전송 용량의 일부를 나타냄)에 일정한 전송률을 예약한다.  
주어진 전송률이 송신자-수신자 연결을 위해 예약되므로 송신자는 수신자에게 보장된(guaranteed) 일정 전송률로 데이터를 보낼 수 있다.

### 회선 교환 네트워크에서의 다중화
링크 내 한 회선은 주파수 분할 다중화 혹인 시분할 다중화로 구현된다.

#### 주파수 분할 다중화
- 주파수 분할 다중화는 링크의 전송 대역폭을 주파수 대역폭으로 분할한다.
### 시분할 다중화
- 시분할 다중화는 링크의 전송 대역폭을 시간 슬롯으로 분할한다.


## 패킷 교환 대 회선 교환
- 회선 교환은 회선을 예약해야 하고 예약된 회선은 통신 세션 동안에 계속 유지되어야 한다.
- 패킷 교환은 회선을 예약할 필요가 없고 패킷이 도착하면 즉시 전송할 수 있다.

링크 전송률을 공유하는 두 방식의 가장 큰 차이점은 회선 교환이 요구에 관계없이 미리 전송 링크의 사용을 할당하는 반면에 패킷 교환은 요구할 때만 링크의 사용을 할당한다는 것이다.  
회선 교환 방식처럼 사용하지 않는 링크 시간에는 링크 사용을 할당할 필요는 없다.  
패킷 교환 방식에서 링크 전송 능력은 링크에 전송할 패킷을 가진 사용자만이 패킷 기반으로 공유한다.
패킷 교환과 회선 교환이 현재 전기통신 네트워크에서 널리 이용되지만 그 추세는 패킷 교환으로 바뀌고 있다.  
오늘날의 많은 회선 교환 전화망이 패킷 교환으로 전환되고 있다.  
특히, 전화망은 비싼 해외 통화 부분을 패킷 교환 방식으로 이용한다.

## 1.3.3 네트워크의 네트워크

### 접속 ISP

- `ISP(Internet Service Provider)` : 패킷 스위치와 통신 링크로 이루어진 네트워크
    1. 종단 시스템에게 다양한 네트워크 접속을 제공한다. (e.g., 가정용 초고속 접속, 고속 LAN 접속, 이동 무선 접속 등)
    2. CP(content provider)에게 인터넷 접속을 제공 → 웹 사이트나 비디오 서버를 인터넷에 직접 연결할 수 있게 된다.


- 종단 시스템(PC, 스마트폰, 웹 서버 등)은 **접속 ISP를 통해 인터넷에 연결된다.**
- 접속 ISP는 다양한 접속 기술(DSL, 케이블, FTTH, 와이파이, 셀룰러(이동 통신) 등)을 이용하여 유선 또는 무선 연결을 제공한다.

<br/>

접속 ISP는 텔코 혹은 케이블 회사일 필요가 없다.  
e.g., 대학교 - 학생, 직원, 교수에게 인터넷 접속을 제공, 회사 - 직원에게 인터넷 접속을 제공

그러나 종단 사용자들과 콘텐츠 제공자들을 모두 접속 ISP로 연결하는 것은 말도 안 된다.

이를 위해서는 **접속 ISP들이 서로 연결되어야만 하기 때문에** `네트워크의 네트워크(network of network)`가 탄생하게 되었다.

<br/>

> 💡 목표 : **모든 종단 시스템이 서로에게 패킷을 보낼 수 있도록** 접속 ISP를 연결하는 것

가장 간단한 방법은 각 접속 ISP를 직접 서로 다른 ISP와 연결하는 것이다.

하지만 각 접속 ISP가 전 세계적으로 다른 접속 ISP와 수십만 개의 개별적인 통신 링크를 유지해야 하기 때문에,  
이런 그물망 설계는 접속 ISP에게 너무 많은 비용을 발생시킨다.

<br/>

오늘날의 인터넷 네트워크 구조를 이해하기 위해 점진적으로 일련의 네트워크 구조를 만들어보자.

<br/>

## 네트워크 구조 1

> 모든 접속 ISP를 **하나의 글로벌 통과(transit) ISP**와 연결한다.

- `글로벌 통과 ISP` : 라우터 + 전 세계에 이르고, 적어도 수십만 개의 접속 ISP와 가까운 곳에 있는 라우터를 갖는 통신 링크의 네트워크
- 글로벌 ISP가 이러한 확장된 네트워크를 구축하는 데는 매우 많은 비용이 든다.
- 글로벌 ISP는 이익을 얻기 위해 **각각의 접속 ISP에 연결을 위한 과금**을 부과한다.
    - 접속 ISP는 `고객(customer)`
    - 글로벌 ISP는 `제공자(provider)`

<br/>
<br/>

## 네트워크 구조 2

어느 회사가 수익을 내는 글로벌 ISP를 구축하고 운영한다면, 다른 회사가 자신의 글로벌 ISP를 구축하여 경쟁하는 것은 자연스러운 일이다.

이것이 네트워크 구조 2로 진화한다.

<br/>

> 수십만 개의 접속 ISP와 **다중의 글로벌 ISP**

- `2계층구조`
    - 상위층 : 글로벌 ISP 서비스 제공자가 존재
    - 하위층 : 접속 ISP가 존재
- **글로벌 ISP들은 서로 연결해야만 한다.**
- 서로 연결되지 않는다면 하나의 글로벌 ISP와 연결된 접속 ISP는 다른 글로벌 통과 서비스 제공자에 연결된 접속 ISP와 통신할 수 없다.

<br/>

### 지역 ISP와 1계층 ISP

현실적으로 전 세계의 모든 도시에 존재하는 ISP는 없다.

대신, 어느 주어진 지역에서 그 지역에 있는 접속 ISP들이 연결하는 `지역(regional) ISP`가 존재하며, 각 지역 ISP는 `1계층(tier-1) ISP`들과 연결된다.  
*(실제로 존재하는 1계층 ISP는 전 세계적으로 모든 도시에 존재하지는 않는다.)*

<br/>
<br/>

## 네트워크 구조 3

> **다중계층구조(접속 ISP, 지역 ISP, 1계층 ISP)** *→ 오늘날의 인터넷과 대략적으로 유사*

여러 경쟁적인 1계층 ISP들이 존재하며, 한 지역에 여러 경쟁적인 지역 ISP들이 존재할 수 있다.

더 복잡한 경우, 작은 지역 ISP들이 연결하는 좀 더 큰 지역 ISP들이 있을 수 있다.

<br/>

이런 계층구조에서의 과금은 크게 다음과 같이 진행된다.

고객 ISP는 글로벌 인터넷 연결성(interconnectivity)을 얻기 위해 서비스 제공 ISP에게 요금을 지불하기 때문에  
"각 레벨에는 고객-제공자 관계가 존재한다"고 할 수 있다.

1. 각각의 **접속 ISP**는 자신이 연결하는 **지역 ISP에게** 요금을 지불한다.
2. 각 **지역 ISP**는 자신이 연결하는 **1계층 ISP에게** 요금을 지불한다.
3. 1계층 ISP는 계층구조의 최상위에 있기 때문에 아무에게도 요금을 지불하지 않는다.

<br/>
<br/>

## 네트워크 구조 4

> 다중계층구조(접속 ISP, 지역 ISP, 1계층 ISP) + **PoP + 멀티홈 + 피어링 + IXP**

<br/>

오늘날의 인터넷과 좀 더 유사한 네트워크를 구축하기 위해서는 네트워크 구조 3에 아래 4가지 항목들을 포함해야 한다.

- `PoP(Points of Presence)`
    - 단지 제공자의 네트워크 내에 있는(같은 위치에 존재하는) 하나 혹은 그 이상의 라우터 그룹
    - 최하위(접속 ISP) 계층을 제외한 모든 계층에 존재하며, **고객 ISP가 제공자 ISP에 연결될 수 있다.**
    - 고객 네트워크가 제공자의 PoP에 연결되기 위해,  
      고객은 자신의 라우터 중 하나를 PoP에 있는 라우터에 직접 연결하도록 **고속 링크를 제3자(third-party) 통신 서비스 제공자로부터 임대할 수 있다.**


- `멀티홈(multi-homing)`
    - **둘 혹은 그 이상의 제공자 ISP에 연결하는 것**
    - e.g., 한 접속 ISP가 2개의 ISP에 연결, 2개의 지역 ISP와 함께 하나의 1계층 ISP에 연결
    - 1계층 ISP를 제외한 모든 ISP는 멀티홈을 선택할 수 있다.
    - 한 ISP가 멀티홈을 하면 서비스 제공자 중 하나가 연결되지 않더라도 인터넷으로 패킷을 계속 송수신할 수 있게 된다.


- `피어링(peering)`
    - 고객 ISP가 서비스 제공 ISP에게 지불하는 요금을 줄이기 위해 **인터넷 계층구조의 같은 계층에 있는 가까운 ISP들은 피어링할 수 있다.**  
      (두 ISP가 피어링하면 일반적으로 서로 요금을 지불하지 않음)
    - 즉, 이들 간에 송수신되는 모든 트래픽을 **상위 계층 ISP를 통하지 않고 직접 송수신할 수 있도록** 자신들의 네트워크를 서로 직접 연결하는 것이다.
    - 1계층 ISP들도 서로 피어링할 수 있다.


- `IXP(Internet Exchange Point)`
    - 다중의 ISP들이 서로 피어링할 수 있는 만남의 장소
    - 일반적으로 교환기를 갖춘 독자적인 빌딩에 존재한다.

<br/>
<br/>

## 네트워크 구조 5

> 다중계층구조(접속 ISP, 지역 ISP, 1계층 ISP) + PoP + 멀티홈 + 피어링 + IXP + **콘텐츠 제공 네트워크**

<br/>

이는 2012년의 인터넷을 기술하며, **구글**이 이러한 콘텐츠 제공자 네트워크 주도하는 한 예이다.

- 구글 데이터 센터는 모두 구글의 사설 TCP/IP 네트워크를 통해 연결되어 있으며, 이 네트워크는 전 세계를 연결하며 공중 인터넷과는 분리되어 있다.
- **구글 사설 네트워크는 구글 서버로 오가는 트래픽만 전달한다.**
- 즉, 하위 계층 ISP들과 피어링을 함으로써(그들과 직접 연결하거나 IXP에서 그들과 연결함으로써) 인터넷의 상위 계층을 ‘`우회(bypass)`’하고 있다.  
  (아래 그림 참고)

<br/>

- 많은 접속 ISP는 여전히 1계층 네트워크를 통해서만 도달할 수 있기 때문에  
  구글 네트워크도 1계층 ISP들과 연결하고 그들과 교환하는 트래픽에 대해 이 ISP들에게 요금을 지불한다.
- 콘텐츠 제공자들이 자신의 네트워크를 구축함으로써 얻는 이점
    - 상위 계층 ISP들에게 지불하는 요금을 줄일 수 있다.
    - 최종 사용자들에게 자신들의 서비스가 궁극적으로 어떻게 전달되는지에 대한 더 많은 통제권을 가질 수 있다.

<br/>

<p align="center"><img width="580" alt="ISP의 연결" src="https://user-images.githubusercontent.com/86337233/210137433-fd5cf02e-5e56-4acc-94c1-d3bdb4697b13.png">

<br/>
<br/>

---